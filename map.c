#include <string.h>
#include "map.h"

// LEYENDA:
// # = Muro
// . = Carretera/Asfalto (Gris)
// E = Entrada
// X = Salida
// _ = Suelo de la plaza

const char *asciiMap[MAP_ROWS] = {
        "#################################################################", // 0
        "#   ENTER   #...............................................# X #", // 1
        "#  EEEEEEE  #...............................................# X #", // 2
        "#. EEEEEEE .................................................# X #", // 3
        "#........... _______ ....... _______ ....... _______ .......# X #", // 4  (Plazas abiertas)
        "#........... _______ ....... _______ ....... _______ .......# X #", // 5
        "#........... _______ ....... _______ ....... _______ .......# X #", // 6
        "#...........................................................# X #", // 7
        "#........... _______ ....... _______ ....... _______ .......#...#", // 8
        "#........... _______ ....... _______ ....... _______ .......#...#", // 9
        "#........... _______ ....... _______ ....... _______ .......#...#", // 10
        "#...........................................................#...#", // 11
        "#........... _______ ....... _______ ....... _______ .......#...#", // 12
        "#........... _______ ....... _______ ....... _______ .......#...#", // 13
        "#........... _______ ....... _______ ....... _______ .......#...#", // 14
        "#...........................................................#...#", // 15
        "#........... _______ ....... _______ ....... _______ .......#...#", // 16
        "#........... _______ ....... _______ ....... _______ .......#...#", // 17
        "#........... _______ ....... _______ ....... _______ .......#...#", // 18
        "#...........................................................#...#", // 19
        "#........... _______ ....... _______ ....... _______ .......#...#", // 20
        "#........... _______ ....... _______ ....... _______ .......#...#", // 21
        "#........... _______ ....... _______ ....... _______ .......#...#", // 22
        "#################################################################"  // 23
};

char parkingMap[MAP_ROWS][MAP_COLS + 1];

// Las coordenadas se mantienen, pero ahora el acceso est√° despejado
ParkingSpot spots[NUM_SPOTS] = {
        // Columna 1 (X=16)
        { 16, 5, 0 }, { 16, 9, 0 }, { 16, 13, 0 }, { 16, 17, 0 }, { 16, 21, 0 },
        // Columna 2 (X=32)
        { 32, 5, 0 }, { 32, 9, 0 }, { 32, 13, 0 }, { 32, 17, 0 }, { 32, 21, 0 },
        // Columna 3 (X=48)
        { 48, 5, 0 }, { 48, 9, 0 }, { 48, 13, 0 }, { 48, 17, 0 }, { 48, 21, 0 },
        // Rellenar hasta 18 spots
        { 16, 21, 0 }, { 32, 21, 0 }, { 48, 21, 0 }
};

void resetMap() {
    for (int i = 0; i < MAP_ROWS; i++) {
        strncpy(parkingMap[i], asciiMap[i], MAP_COLS);
        parkingMap[i][MAP_COLS] = '\0';
    }
    for (int i = 0; i < NUM_SPOTS; i++) {
        spots[i].isOccupied = 0;
    }
}

int findFreeSpot() {
    for (int i = 0; i < NUM_SPOTS; i++) {
        if (spots[i].isOccupied == 0) return i;
    }
    return -1;
}

void occupySpot(int spotIndex) {
    if (spotIndex >= 0 && spotIndex < NUM_SPOTS) {
        spots[spotIndex].isOccupied = 1;
    }
}