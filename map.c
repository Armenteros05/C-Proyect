#include <string.h>
#include "map.h"

// DiseÃ±o Visual: P = Parking, R = Road (Carretera)
// Estructura: [ P ] [ R ] [ P ] [ R ] [ P ]
const char *asciiMap[MAP_ROWS] = {
        "+=============================================================+", // 0
        "| ENTER -> .................................................  |", // 1
        "| ..........................................................  |", // 2
        "+-------+   | . |   +-------+   | . |   +-------+",              // 3
        "|       |   | . |   |       |   | . |   |       |",              // 4 (Y=4)
        "+-------+   | . |   +-------+   | . |   +-------+",              // 5
        "            | . |               | . |            ",              // 6
        "+-------+   | . |   +-------+   | . |   +-------+",              // 7
        "|       |   | . |   |       |   | . |   |       |",              // 8 (Y=8)
        "+-------+   | . |   +-------+   | . |   +-------+",              // 9
        "            | . |               | . |            ",              // 10
        "+-------+   | . |   +-------+   | . |   +-------+",              // 11
        "|       |   | . |   |       |   | . |   |       |",              // 12 (Y=12)
        "+-------+   | . |   +-------+   | . |   +-------+",              // 13
        "            | . |               | . |            ",              // 14
        "+-------+   | . |   +-------+   | . |   +-------+",              // 15
        "|       |   | . |   |       |   | . |   |       |",              // 16 (Y=16)
        "+-------+   | . |   +-------+   | . |   +-------+",              // 17
        "            | . |               | . |            ",              // 18
        "+-------+   | . |   +-------+   | . |   +-------+",              // 19
        "|       |   | . |   |       |   | . |   |       |",              // 20 (Y=20)
        "+-------+   | . |   +-------+   | . |   +-------+",              // 21
        "|                                             |               |", // 22
        "+-------------------------------------------------------------+"  // 23
};

char parkingMap[MAP_ROWS][MAP_COLS + 1];

// Coordenadas X, Y donde el coche se detiene (Centro de la plaza)
ParkingSpot spots[NUM_SPOTS] = {
        // --- COLUMNA 1 (Izquierda) ---
        { 4, 4, 0 }, { 4, 8, 0 }, { 4, 12, 0 }, { 4, 16, 0 }, { 4, 20, 0 }, { 4, 20, 0 },
        // --- COLUMNA 2 (Centro) ---
        { 24, 4, 0 }, { 24, 8, 0 }, { 24, 12, 0 }, { 24, 16, 0 }, { 24, 20, 0 }, { 24, 20, 0 },
        // --- COLUMNA 3 (Derecha) ---
        { 44, 4, 0 }, { 44, 8, 0 }, { 44, 12, 0 }, { 44, 16, 0 }, { 44, 20, 0 }, { 44, 20, 0 }
};

void resetMap() {
    for (int i = 0; i < MAP_ROWS; i++) {
        strncpy(parkingMap[i], asciiMap[i], MAP_COLS);
        parkingMap[i][MAP_COLS] = '\0';
    }
    for (int i = 0; i < NUM_SPOTS; i++) {
        spots[i].isOccupied = 0;
    }
}

int findFreeSpot() {
    for (int i = 0; i < NUM_SPOTS; i++) {
        if (spots[i].isOccupied == 0) return i;
    }
    return -1;
}

void occupySpot(int spotIndex) {
    if (spotIndex >= 0 && spotIndex < NUM_SPOTS) {
        spots[spotIndex].isOccupied = 1;
    }
}